<!doctype html>
<html lang="en"><head>
<meta charset="utf-8" />
<title>ION7 — Sign in</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" rel="stylesheet">
<style>
  body{min-height:100vh;display:grid;place-items:center;background:#0f172a}
  .card{max-width:420px;width:100%;background:#0b1022;color:#e5e7eb;padding:28px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .sub{color:#94a3b8;margin-bottom:18px}
  .error,.ok{padding:10px;border-radius:8px;margin-bottom:12px;display:none}
  .error{background:#fecaca;color:#7f1d1d}.ok{background:#bbf7d0;color:#14532d}
  button[type=submit]{width:100%}
</style>
</head>
<body>
  <main class="card">
    <h1>ION7 — Sign in</h1>
    <p class="sub">Demo access for your client preview.</p>
    <div id="msgError" class="error"></div><div id="msgOk" class="ok"></div>
    <form id="loginForm">
      <label>Email</label><input id="email" type="email" placeholder="client@ion7-demo.com" required>
      <label>Password</label><input id="password" type="password" placeholder="••••••••" required>
      <button type="submit">Sign in</button>
    </form>
  </main>

<script>
  // ===== Redirect target on success (your cPanel page) =====
  window.CPANEL_BASE = "https://ion7.mavsketch.com";       // change if needed
  const DEST_SLUG  = "home-page";                          // change if needed
  const DEST_URL   = `${(window.CPANEL_BASE || location.origin).replace(/\/+$/,"")}/page.html?slug=${encodeURIComponent(DEST_SLUG)}`;
  const API = "/api/auth";

  const $err=document.getElementById("msgError");
  const $ok =document.getElementById("msgOk");
  const showErr=(m)=>{$err.textContent=m;$err.style.display="block";$ok.style.display="none";};
  const showOk =(m)=>{$ok.textContent=m;$ok.style.display="block";$err.style.display="none";};

  // If already logged in, go straight to the site
  (async function checkMe(){
    try{
      const r=await fetch(`${API}/me`,{credentials:"include"});
      const j=await r.json();
      if(j?.user?.email){ location.replace(DEST_URL); }
    }catch{}
  })();

  document.getElementById("loginForm").addEventListener("submit",async(e)=>{
    e.preventDefault();
    const email=(document.getElementById("email").value||"").trim();
    const password=document.getElementById("password").value||"";
    if(!email||!password) return showErr("Please enter email and password.");
    try{
      const resp=await fetch(`${API}/login`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        credentials:"include",
        body:JSON.stringify({email,password})
      });
      const data=await resp.json();
      if(!resp.ok) return showErr(data?.error||"Login failed.");
      showOk("Logged in! Redirecting…");
      setTimeout(()=>location.replace(DEST_URL),400);
    }catch{showErr("Network/server error.");}
  });
</script>
</body></html>
